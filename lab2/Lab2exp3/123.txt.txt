#include "stm32f10x.h"

void Delay(u32 count)
{
	u32 i;
	for (i=0;i<count;i++);
}

int main(void)
{
	// GPIO_InitTypeDef GPIO_InitStructure;
	// RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);
	RCC->APB2ENR |= (1<<3) | (1<<6);
	
	// Init light DS0
	// GPIO_InitStructure.GPIO_Pin=GPIO_Pin_5;
	// GPIO_InitStructure.GPIO_Mode=GPIO_Mode_Out_PP;
	// GPIO_InitStructure.GPIO_Speed=GPIO_Speed_50MHz;
	// GPIO_Init(GPIOB, &GPIO_InitStructure);
	// GPIO_SetBits(GPIOB, GPIO_Pin_5);
	GPIOB -> CRL &= 0xFF0FFFFF;
	GPIOB -> CRL |= 0x00300000;
	GPIOB -> ODR |= (1<<5);
	
	// Init PE2
	// GPIO_InitTypeDef GPIO_InitStructure_Press;
	// RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOE, ENABLE);
	// GPIO_InitStructure_Press.GPIO_Pin=GPIO_Pin_2;
	// GPIO_InitStructure_Press.GPIO_Mode=GPIO_Mode_IPU;
	// GPIO_InitStructure_Press.GPIO_Speed=GPIO_Speed_50MHz;
	// GPIO_Init(GPIOE, &GPIO_InitStructure_Press);
	
	GPIOE -> CRL &= 0xFFFFF0FF;
	GPIOE -> CRL |= 0x00000800;
	// GPIOE -> ODR |= 1<<2;
	GPIOE ->ODR &= ~(1<<2);
	while(1)
	{
		// read the state
		// u8 pinState = GPIO_ReadInputDataBit(GPIOE, GPIO_Pin_2);
		// if pressed, IDR is 0,then the condition is not true, 
		// pinState is 0, light up;
		u8 pinState = (GPIOE->IDR & (1<<2)) ? 1 : 0;
		
		if (pinState == 1){
			// GPIO_ResetBits(GPIOB, GPIO_Pin_5);
			// light up 
			GPIOB->BSRR = 1<<5;
		}
		else
		{
			// GPIO_SetBits(GPIOB, GPIO_Pin_5);
			// light down
			GPIOB->BRR |= 1<<5;
		}
	}
}
